# Malware Analysis Lab

## Exercise 1: Network Traffic Analysis with Wireshark

**Tools:**
- Wireshark
- HTTP
- Follow > HTTP Stream

**Objective:**
Analyze HTTP network traffic to understand malware behavior.

**Steps:**
1. **Setup Wireshark:**
   - Install Wireshark from [Wireshark Download](https://www.wireshark.org/download.html).
   - Select the appropriate network interface.

2. **Capture Traffic:**
   - Start capturing packets.
   - Run the malware sample in a controlled environment.
   - Stop the capture after sufficient activity.

3. **Filter and Analyze HTTP:**
   - Apply `http` filter.
   - Right-click an HTTP packet and select **Follow > HTTP Stream**.
   - Examine the HTTP conversation for suspicious activities.

4. **Save Findings:**
   - Export the HTTP stream if needed.
   - Document any anomalies or suspicious data.

---

## Exercise 2: Process and File Analysis with VirusTotal and Process Hacker

**Tools:**
- VirusTotal
- Process Hacker

**Objective:**
Analyze suspicious files and monitor running processes for malware detection.

**Steps:**
1. **VirusTotal:**
   - Upload the suspicious file to [VirusTotal](https://www.virustotal.com/).
   - Review scan results from multiple antivirus engines.

2. **Process Hacker:**
   - Install [Process Hacker](https://processhacker.sourceforge.io/).
   - Run as Administrator.
   - Identify and inspect suspicious processes.
   - Terminate malicious processes if necessary.

3. **Correlate Findings:**
   - Match VirusTotal results with Process Hacker data.
   - Investigate parent processes and document findings.

---

## Exercise 3: Binary Analysis with a Hex Editor

**Tool:**
- Hex Editor (e.g., [HxD](https://mh-nexus.de/en/hxd/))

**Objective:**
Inspect the binary structure of malware to identify patterns or signatures.

**Steps:**
1. **Open Malware in Hex Editor:**
   - Launch the Hex Editor and open the malware executable.

2. **Examine Data:**
   - Identify readable strings and file headers.
   - Search for known or custom malware signatures.

3. **Analyze Structure:**
   - Check different sections (e.g., `.text`, `.data`).
   - Look for embedded payloads or resources.

4. **Document Findings:**
   - Note suspicious strings and unusual structures.

---

## Exercise 4: Network Connections Analysis with CMD NetStat and TCPView

**Tools:**
- CMD NetStat (`netstat -an`, `netstat -ano`)
- TCPView

**Objective:**
Monitor active network connections and associated processes to detect malicious activity.

**Steps:**
1. **CMD NetStat:**
   - Open Command Prompt as Administrator.
   - Run `netstat -an` and `netstat -ano`.
   - Identify unfamiliar IPs or ports.

2. **TCPView:**
   - Download and run [TCPView](https://docs.microsoft.com/en-us/sysinternals/downloads/tcpview).
   - Monitor real-time connections.
   - Inspect and terminate suspicious processes.

3. **Correlate Data:**
   - Match PIDs with Process Hacker.
   - Research unknown IP addresses.

4. **Document Findings:**
   - Record suspicious connections and related processes.

---

## Exercise 5: System Analysis with Avira Antivirus, WinPrefetch View, Event Log Explorer, and Registry Ripper

**Tools:**
- Avira Antivirus
- WinPrefetch View ([Download](https://www.nirsoft.net/utils/win_prefetch_view.html))
- Event Log Explorer ([Download](https://eventlogxp.com/))
- Registry Ripper ([Download](https://github.com/keydet89/RegRipper3.0))

**Objective:**
Detect malware persistence and system modifications through comprehensive system analysis.

**Steps:**
1. **Avira Antivirus:**
   - Update and perform a full system scan.
   - Review detected threats.

2. **WinPrefetch View:**
   - Analyze prefetch files for unusual executables.

3. **Event Log Explorer:**
   - Examine security, system, and application logs for anomalies.

4. **Registry Ripper:**
   - Extract and analyze registry hives for suspicious entries.

5. **Correlate Findings:**
   - Identify persistence mechanisms like Run keys or scheduled tasks.

6. **Document Findings:**
   - Detail detected threats and system modifications.

---

## Exercise 6: BASE64 Encoding/Decoding

**Tool:**
- BASE64 Encoder/Decoder (e.g., [CyberChef](https://gchq.github.io/CyberChef/))

**Objective:**
Encode or decode data using BASE64 to uncover obfuscated payloads or communications.

**Steps:**
1. **Identify BASE64 Data:**
   - Look for strings ending with `==` or containing A-Z, a-z, 0-9, `+`, `/`.

2. **Decode BASE64:**
   - Use CyberChef’s **From Base64** operation or command-line tools.

3. **Encode Data:**
   - Use CyberChef’s **To Base64** operation or command-line tools.

4. **Analyze Decoded Data:**
   - Check for scripts, URLs, or binary payloads.

5. **Automate if Needed:**
   - Write scripts for bulk decoding tasks.

6. **Document Findings:**
   - Record decoded information relevant to malware behavior.

---

## Exercise 7: Dynamic Malware Analysis with Cuckoo Sandbox, VirusTotal, and Hybrid Analysis

**Tools:**
- Cuckoo Sandbox ([Website](https://cuckoosandbox.org/))
- VirusTotal
- Hybrid Analysis ([Website](https://www.hybrid-analysis.com/))

**Objective:**
Execute malware in a controlled environment and gather behavior reports.

**Steps:**
1. **Set Up Cuckoo Sandbox:**
   - Install and configure following [Cuckoo Docs](https://cuckoosandbox.org/docs/installation/).

2. **Prepare and Submit Malware:**
   - Safely transfer and submit the sample to Cuckoo.

3. **Review Cuckoo Reports:**
   - Examine file changes, network activity, and process behavior.

4. **Use VirusTotal and Hybrid Analysis:**
   - Upload the sample to [VirusTotal](https://www.virustotal.com/) and [Hybrid Analysis](https://www.hybrid-analysis.com/).
   - Compare and correlate findings.

5. **Document Findings:**
   - Summarize behavior, network communications, and Indicators of Compromise (IoCs).

---

## Exercise 8: Antivirus Detection with Avira Antivirus

**Tool:**
- Avira Antivirus ([Download](https://www.avira.com/en/free-antivirus-windows))

**Objective:**
Detect and remove malware using Avira Antivirus.

**Steps:**
1. **Install Avira:**
   - Download and install from Avira’s official site.

2. **Update Definitions:**
   - Ensure virus definitions are up-to-date.

3. **Perform a Full Scan:**
   - Run a complete system scan and monitor progress.

4. **Review and Act on Results:**
   - Quarantine or remove detected threats.

5. **Test Detection (Optional):**
   - Use the EICAR test file to verify Avira’s functionality.

6. **Configure Protection Settings:**
   - Enable real-time protection and adjust preferences.

7. **Document Findings:**
   - Note the effectiveness of detections and any patterns observed.

---

## Exercise 9: Android Malware Analysis

**Objective:**
Analyze malware targeting Android devices to understand its behavior and impact.

**Steps:**
1. **Setup Environment:**
   - Use an emulator (e.g., Android Studio) or a dedicated physical device.
   - Ensure isolation from your main network.

2. **Install Tools:**
   - APKTool, MobSF, Frida, Wireshark/Tcpdump.

3. **Static Analysis:**
   - Decompile APK with APKTool.
   - Examine `AndroidManifest.xml` and analyze code for suspicious API calls.

4. **Dynamic Analysis:**
   - Use MobSF for automated analysis.
   - Employ Frida for real-time instrumentation.

5. **Network Traffic Analysis:**
   - Capture and inspect network communications for malicious activity.

6. **Reverse Engineering:**
   - Use JADX to decompile and review Java code.

7. **Identify Persistence:**
   - Look for services, receivers, or scheduled tasks ensuring malware runs on startup.

8. **Document Findings:**
   - Detail malware capabilities, infection vectors, and Indicators of Compromise (IoCs).

---
